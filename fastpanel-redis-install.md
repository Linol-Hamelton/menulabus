# Установка расширения PHP‑Redis через панель FastPanel

## Проблема
Команды `sudo apt install php-redis` и `sudo apt install php-memcached` не работают (ошибка 500). На shared‑хостинге управление пакетами обычно осуществляется через панель управления, а не через командную строку.

## Решение через FastPanel

1. **Войдите в панель управления FastPanel** по адресу `https://ваш-сервер:8888` (или другому, предоставленному хостинг‑провайдером).

2. **Перейдите в раздел «PHP»** (или «PHP‑модули»).

3. **Выберите версию PHP**, используемую вашим сайтом (скорее всего, **8.3**).

4. **Найдите модуль «redis»** в списке доступных расширений.

5. **Установите модуль**, нажав соответствующую кнопку (например, «Включить» или «Установить»).

6. **Повторите для модуля «memcached»**, если планируете использовать Memcached (опционально).

7. **Перезапустите PHP‑FPM** после установки модулей. Обычно это можно сделать в том же разделе или в «Управление службами».

## Альтернативный способ: установка через PECL (если есть доступ к shell)

Если панель не предоставляет модуль Redis, но у вас есть доступ к SSH с правами на компиляцию, можно установить через PECL:

```bash
pecl install redis
```

После успешной установки добавьте расширение в конфигурацию PHP:

```bash
echo "extension=redis.so" >> /etc/php/8.3/fpm/php.ini
echo "extension=redis.so" >> /etc/php/8.3/cli/php.ini
```

Перезапустите PHP‑FPM:

```bash
systemctl restart php8.3-fpm
```

## Проверка установки

После установки выполните проверку:

1. Загрузите файл `test-redis.php` на сервер в корень сайта.
2. Откройте в браузере `https://menu.labus.pro/test-redis.php`.
3. Если расширение установлено, вы увидите сообщение «SUCCESS: Redis connection established».

Если Redis по‑прежнему не подключается, проверьте, что служба Redis запущена на localhost:6379 (она уже работает, судя по предоставленному конфигу).

## Если установка невозможна

Если по каким‑то причинам установить Redis не получается, можно:

1. **Использовать Memcached** (установите модуль `php‑memcached` через панель).
2. **Оставить файловые сессии**, но переместить каталог сессий в tmpfs (требует прав root):

   ```bash
   mkdir -p /var/www/labus_pro_usr/data/www/menu.labus.pro/data/tmp
   mount -t tmpfs -o size=256M tmpfs /var/www/labus_pro_usr/data/www/menu.labus.pro/data/tmp
   ```

   Добавьте соответствующую строку в `/etc/fstab` для автоматического монтирования после перезагрузки.

3. **Использовать кэширование сессий в БД** через MEMORY‑таблицу (менее эффективно, но лучше файлов).

## Дальнейшие шаги

После успешной установки Redis сессии автоматически переключатся на него (см. код `session_init.php`). Убедитесь, что в логах нет ошибок, и выполните нагрузочный тест.