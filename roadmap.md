# üöÄ –ü–û–õ–ù–´–ô –ü–õ–ê–ù –†–ï–í–û–õ–Æ–¶–ò–û–ù–ù–û–ô –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò menu.labus.pro

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 8 —Ñ–µ–≤—Ä–∞–ª—è 2026  
**–¶–µ–ª—å:** –£–≤–µ–ª–∏—á–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ 3-10√ó –∑–∞ —Å—á–µ—Ç —Ä–∞–¥–∏–∫–∞–ª—å–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –ë–î, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ —Å—Ç–µ–∫–∞ (Nginx + PHP-FPM + MySQL + Redis) –≤ —É—Å–ª–æ–≤–∏—è—Ö —Ö–æ—Å—Ç–∏–Ω–≥–∞ Beget —á–µ—Ä–µ–∑ FastPanel.

---

## üìä EXECUTIVE SUMMARY

–í–∞—à –ø—Ä–æ–µ–∫—Ç **—É–∂–µ –∏–º–µ–µ—Ç –æ—Ç–ª–∏—á–Ω—É—é –±–∞–∑—É**: Redis, QueryCache, –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ statements, FastCGI cache. –û–¥–Ω–∞–∫–æ –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –≤—ã—è–≤–∏–ª **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–∑–∫–∏–µ –º–µ—Å—Ç–∞**, —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä—ã—Ö –¥–∞—Å—Ç –∫—Ä–∞—Ç–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

### –¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (–∫—Ä–∏—Ç–∏—á–Ω—ã–µ):
1. **–ë–î –Ω–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ–¥ –≤—ã—Å–æ–∫—É—é –Ω–∞–≥—Ä—É–∑–∫—É**: –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤, JSON-–ø–∞—Ä—Å–∏–Ω–≥ –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
2. **Redis –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ**: –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ pipeline/mget, –Ω–µ—Ç –ø—Ä–æ–≥—Ä–µ–≤–∞ –∫—ç—à–∞, TTL –Ω–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
3. **PHP-FPM –≤ —Ä–µ–∂–∏–º–µ `dynamic`**: —Ñ–æ—Ä–∫–∏–Ω–≥ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π –≤–º–µ—Å—Ç–æ `static` —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø—É–ª–æ–º
4. **JIT –æ—Ç–∫–ª—é—á–µ–Ω**: PHP 8.0+ –º–æ–∂–µ—Ç –¥–∞—Ç—å +20-40% —Å–∫–æ—Ä–æ—Å—Ç–∏ —Å JIT
5. **Nginx FastCGI cache –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–≥—Ä–µ—Å—Å–∏–≤–µ–Ω**: –∫–æ—Ä–æ—Ç–∫–∏–µ TTL, –Ω–µ—Ç microcache –¥–ª—è API
6. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö** –≤ —Ç–∞–±–ª–∏—Ü–µ `orders` –∏ `order_status_history`

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ (—Ü–µ–ª—å) | –ü—Ä–∏—Ä–æ—Å—Ç |
|---------|-----|--------------|---------|
| **RPS –∫ –ë–î** | ~50-100 | 500-1000+ | **5-10√ó** |
| **TTFB (cached)** | 50-100ms | 10-20ms | **5√ó** |
| **TTFB (uncached)** | 200-400ms | 30-80ms | **5-7√ó** |
| **Cache hit rate** | 60-70% | 95-98% | **+30%** |
| **p95 latency** | 300-500ms | <100ms | **3-5√ó** |
| **Max concurrent users** | 100-200 | 500-1000 | **5√ó** |

---

## üîç –ì–õ–£–ë–û–ö–ò–ô –ê–ù–ê–õ–ò–ó –¢–ï–ö–£–©–ï–ô –ê–†–•–ò–¢–ï–ö–¢–£–†–´

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (MySQL)

#### –ü—Ä–æ–±–ª–µ–º—ã –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –≤ `db.php`:

**1.1. –¢–∞–±–ª–∏—Ü–∞ `menu_items` ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤**

–¢–µ–∫—É—â–∏–π –∑–∞–ø—Ä–æ—Å:
```php
$sql = "SELECT id, name, description, composition, price, image, 
       calories, protein, fat, carbs, category, available 
       FROM menu_items WHERE available = 1";

if ($category) {
    $sql .= " AND category = :category";
}
$sql .= " ORDER BY category, name";
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–æ—Å—Ç–∞–≤–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ `(available, category, name)`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫—Ä–æ–µ—Ç WHERE + ORDER BY.

**1.2. –¢–∞–±–ª–∏—Ü–∞ `orders` ‚Äî JSON-–ø–∞—Ä—Å–∏–Ω–≥ –≤ MySQL**

–ú–Ω–æ–∂–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `JSON_TABLE()` –¥–ª—è —Ä–∞–∑–±–æ—Ä–∞ –∫–æ–ª–æ–Ω–∫–∏ `items`.

**–ü—Ä–æ–±–ª–µ–º–∞**: JSON-–ø–∞—Ä—Å–∏–Ω–≥ –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω—ã–π –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π.

**–†–µ—à–µ–Ω–∏–µ**: generated columns –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–æ–ª–µ–π.

**1.3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**

–¢–∞–±–ª–∏—Ü—ã `orders` –∏ `order_status_history` —Ä–∞—Å—Ç—É—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ**: –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ `created_at` (RANGE –ø–æ –º–µ—Å—è—Ü–∞–º).

---

### 2. Redis Cache

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –Ω–µ—Ç `mget/mset` (batch)
- –Ω–µ—Ç –ø—Ä–æ–≥—Ä–µ–≤–∞
- TTL —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–µ

---

### 3. PHP-FPM

**–ü—Ä–æ–±–ª–µ–º—ã:**
- `pm = dynamic` –≤–º–µ—Å—Ç–æ `static`
- JIT –≤—ã–∫–ª—é—á–µ–Ω
- OPcache –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–µ –∫–∞–∫ production

---

### 4. Nginx

**–ü—Ä–æ–±–ª–µ–º—ã:**
- TTL –∫—ç—à–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –º–µ–Ω—é
- –Ω–µ—Ç microcache –¥–ª—è GET API
- –Ω–µ—Ç `fastcgi_keep_conn on` + upstream keepalive

---

## üéØ –†–ï–í–û–õ–Æ–¶–ò–û–ù–ù–ê–Ø –î–û–†–û–ñ–ù–ê–Ø –ö–ê–†–¢–ê (6 –ù–ï–î–ï–õ–¨)

### –§–∞–∑–∞ 1: –ë–ê–ó–ê –î–ê–ù–ù–´–• ‚Äî –ò–Ω–¥–µ–∫—Å—ã –∏ –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (–ù–µ–¥–µ–ª—è 1-2)

#### –ù–µ–¥–µ–ª—è 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–µ–∫—Å—ã

```sql
ALTER TABLE menu_items 
ADD INDEX idx_menu_available_category_name (available, category, name);

ALTER TABLE orders
ADD INDEX idx_orders_status_created (status, created_at);

ALTER TABLE orders
ADD INDEX idx_orders_user_created (user_id, created_at DESC);
```

#### –ù–µ–¥–µ–ª—è 2: Generated columns + –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

```sql
ALTER TABLE orders
ADD COLUMN total_items INT GENERATED ALWAYS AS (JSON_LENGTH(items)) VIRTUAL;

ALTER TABLE orders
ADD INDEX idx_orders_total_items (total_items);
```

–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:
```sql
ALTER TABLE orders
PARTITION BY RANGE (UNIX_TIMESTAMP(created_at)) (
  PARTITION p202602 VALUES LESS THAN (UNIX_TIMESTAMP('2026-03-01')),
  PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

---

### –§–∞–∑–∞ 2: PHP-FPM + OPcache + JIT (–ù–µ–¥–µ–ª—è 3)

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ö–µ–º–∞:
```ini
pm = static
pm.max_children = 35
php_admin_value[opcache.validate_timestamps] = 0
php_admin_value[opcache.jit] = tracing
php_admin_value[opcache.jit_buffer_size] = 128M
```

---

### –§–∞–∑–∞ 3: Redis 2.0 + Cache warming (–ù–µ–¥–µ–ª—è 4)

- –í–Ω–µ–¥—Ä–∏—Ç—å `mget/mset` —Å pipeline
- –î–æ–±–∞–≤–∏—Ç—å `getOrSet`
- –î–æ–±–∞–≤–∏—Ç—å `cache-warmer.php` –∏ cron –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç

---

### –§–∞–∑–∞ 4: Nginx microcache + keepalive (–ù–µ–¥–µ–ª—è 5)

```nginx
upstream php_fpm_backend {
  server unix:/var/run/menu.labus.pro.sock;
  keepalive 32;
}

location / {
  fastcgi_keep_conn on;
  fastcgi_cache CAFECACHE;
  fastcgi_cache_valid 200 2h;
  add_header X-Cache-Status $upstream_cache_status;
}
```

---

### –§–∞–∑–∞ 5: –ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (–ù–µ–¥–µ–ª—è 6)

- `pt-query-digest` –æ—Ç—á—ë—Ç—ã –ø–æ slow log
- `db-monitor.php`
- –±—ç–∫–∞–ø—ã –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ cron

---

## üß™ –ù–ê–ì–†–£–ó–û–ß–ù–û–ï –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### ab
```bash
ab -n 10000 -c 50 https://menu.labus.pro/menu.php
```

### k6
(—Å–∫—Ä–∏–ø—Ç –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ –ø—Ä–∏–ª–æ–∂–∏—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –∑–∞–ø—É—Å–∫–∞—Ç—å –∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è)

---

## ‚ö†Ô∏è –†–ò–°–ö–ò –ò –û–¢–ö–ê–¢

- –í—Å–µ–≥–¥–∞ –¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø –ë–î –ø–µ—Ä–µ–¥ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- –í–Ω–æ—Å–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ –æ–¥–Ω–æ–π —Ñ–∞–∑–µ
- –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è: `nginx -t`, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –∏ –º–∏–Ω–∏-load test

---

## üöÄ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏—Ä–æ—Å—Ç –¥–∞—Å—Ç —Å–≤—è–∑–∫–∞:
1) –∏–Ω–¥–µ–∫—Å—ã + generated columns  
2) Redis warming + batch  
3) PHP-FPM static + JIT  
4) Nginx keepalive + aggressive cache

–≠—Ç–æ —Ä–µ–∞–ª—å–Ω—ã–π –ø—É—Ç—å –∫ **3‚Äì10√ó —É—Å–∫–æ—Ä–µ–Ω–∏—é** –±–µ–∑ —Å–º–µ–Ω—ã —Å—Ç–µ–∫–∞.
