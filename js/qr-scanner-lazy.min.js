/* MenuLabus - Optimized */
class QRScannerManagerLazy{constructor(){this.scanner=null,this.isScanning=!1,this.scanAttempts=0,this.maxScanAttempts=50,this.qrLibLoaded=!1,this.qrLibLoading=!1,this.qrLibLoadPromise=null}async loadQRLibrary(){return this.qrLibLoaded||"undefined"!=typeof Html5Qrcode?(this.qrLibLoaded=!0,Promise.resolve()):(this.qrLibLoading&&this.qrLibLoadPromise||(this.qrLibLoading=!0,this.qrLibLoadPromise=new Promise((e,n)=>{const i=document.createElement("script"),r=window.APP_VERSION||Date.now();i.src=`/js/html5-qrcode.min.js?v=${r}`,i.onload=()=>{this.qrLibLoaded=!0,this.qrLibLoading=!1,console.log("âœ… QR Scanner library loaded successfully"),e()},i.onerror=e=>{this.qrLibLoading=!1,this.qrLibLoadPromise=null,console.error("âŒ Failed to load QR Scanner library:",e),n(new Error("QR_LIBRARY_LOAD_FAILED"))},document.head.appendChild(i)})),this.qrLibLoadPromise)}async startScanning(e,n){if(this.isScanning)await this.stopScanning();else try{if(await this.loadQRLibrary(),"undefined"==typeof Html5Qrcode)throw new Error("QR Scanner library failed to load");this.scanner=new Html5Qrcode(e),this.scanAttempts=0;const i={fps:15,qrbox:{width:250,height:250},aspectRatio:1,disableFlip:!1},r={facingMode:"environment"};return await this.scanner.start(r,i,e=>{this.scanAttempts=0,n(e)},e=>{if(this.scanAttempts++,e&&"string"==typeof e){if(e.includes("No QR code found")||e.includes("NotFoundException")){if(this.scanAttempts>this.maxScanAttempts)throw this.stopScanning(),new Error("QR_CODE_NOT_FOUND");return}e.includes("No MultiFormat Readers")||console.warn("Scan error:",e)}}),this.isScanning=!0,!0}catch(e){let n="UNKNOWN_ERROR";if(e&&"object"==typeof e){const i=e.message||"",r=e.name||"";i.includes("not found")||i.includes("NotFoundError")||r.includes("NotFound")?n="CAMERA_NOT_FOUND":i.includes("Permission")||i.includes("NotAllowed")||r.includes("NotAllowed")?n="PERMISSION_DENIED":i.includes("cameraIdOrConfig")?n="CONFIG_ERROR":i.includes("QR_LIBRARY_LOAD_FAILED")&&(n="LIBRARY_LOAD_FAILED")}throw new Error(n)}}async stopScanning(){if(this.scanner&&this.isScanning){try{await this.scanner.stop()}catch(e){const n=e?.message||"";n.includes("already stopped")||n.includes("not running")||console.warn("Scanner stop error:",e)}this.scanner=null,this.isScanning=!1,this.scanAttempts=0}}async checkCameraSupport(){try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return{supported:!1,reason:"Ð‘Ñ€Ð°ÑƒÐ·ÐµÑ€ Ð½Ðµ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ ÐºÐ°Ð¼ÐµÑ€Ñƒ"};const e=(await navigator.mediaDevices.enumerateDevices()).filter(e=>"videoinput"===e.kind);return{supported:e.length>0,cameras:e.length,hasBackCamera:e.some(e=>e.label.toLowerCase().includes("back")||e.label.toLowerCase().includes("rear"))}}catch(e){return{supported:!1,reason:e.message}}}preload(){return this.loadQRLibrary()}destroy(){this.stopScanning()}}"undefined"!=typeof window&&(window.QRScannerManagerLazy=QRScannerManagerLazy,navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(window.qrScannerManager=new QRScannerManagerLazy,console.log("ðŸ”„ QR Scanner initialized with lazy loading (Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑÑ Ð¿Ñ€Ð¸ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ÑÑ‚Ð¸)")):(console.warn("Camera API not supported in this browser"),window.qrScannerManager={startScanning:()=>Promise.reject(new Error("CAMERA_NOT_SUPPORTED")),stopScanning:()=>{},checkCameraSupport:()=>Promise.resolve({supported:!1,reason:"Not supported"}),preload:()=>Promise.resolve()}));