/* MenuLabus - Optimized */
class QRScannerManager{constructor(){this.scanner=null,this.isScanning=!1,this.scanAttempts=0,this.maxScanAttempts=50}async startScanning(n,e){if(this.isScanning)await this.stopScanning();else{if("undefined"==typeof Html5Qrcode)throw new Error("QR Scanner library not loaded");try{this.scanner=new Html5Qrcode(n),this.scanAttempts=0;const t={fps:15,qrbox:{width:250,height:250},aspectRatio:1,disableFlip:!1},s={facingMode:"environment"};return await this.scanner.start(s,t,n=>{this.scanAttempts=0,e(n)},n=>{if(this.scanAttempts++,n&&"string"==typeof n){if(n.includes("No QR code found")||n.includes("NotFoundException")){if(this.scanAttempts,this.scanAttempts>this.maxScanAttempts)throw this.stopScanning(),new Error("QR_CODE_NOT_FOUND");return}n.includes("No MultiFormat Readers")||console.warn("Scan error:",n)}else console.warn("Unknown scan error:",n)}),this.isScanning=!0,!0}catch(n){let e="UNKNOWN_ERROR";if(n&&"object"==typeof n){const t=n.message||"",s=n.name||"";t.includes("not found")||t.includes("NotFoundError")||s.includes("NotFound")?e="CAMERA_NOT_FOUND":t.includes("Permission")||t.includes("NotAllowed")||s.includes("NotAllowed")?e="PERMISSION_DENIED":t.includes("cameraIdOrConfig")&&(e="CONFIG_ERROR")}throw new Error(e)}}}async stopScanning(){if(this.scanner&&this.isScanning){try{await this.scanner.stop()}catch(n){const e=n?.message||"";e.includes("already stopped")||e.includes("not running")||console.warn("Scanner stop error:",n)}this.scanner=null,this.isScanning=!1,this.scanAttempts=0}}async checkCameraSupport(){try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return{supported:!1,reason:"Браузер не поддерживает камеру"};const n=(await navigator.mediaDevices.enumerateDevices()).filter(n=>"videoinput"===n.kind);return{supported:n.length>0,cameras:n.length,hasBackCamera:n.some(n=>n.label.toLowerCase().includes("back")||n.label.toLowerCase().includes("rear"))}}catch(n){return{supported:!1,reason:n.message}}}destroy(){this.stopScanning()}}"undefined"!=typeof window&&(window.QRScannerManager=QRScannerManager,navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?window.qrScannerManager=new QRScannerManager:(console.warn("Camera API not supported in this browser"),window.qrScannerManager={startScanning:()=>Promise.reject(new Error("CAMERA_NOT_SUPPORTED")),stopScanning:()=>{},checkCameraSupport:()=>Promise.resolve({supported:!1,reason:"Not supported"})}));