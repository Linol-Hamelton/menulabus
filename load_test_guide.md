# Руководство по нагрузочному тестированию

## 1. Установка зависимостей

Скрипт использует библиотеку `requests`. Если она не установлена, выполните:

```bash
pip install requests
```

Для Python 3 может потребоваться `pip3`.

## 2. Запуск теста

Базовый тест для главной страницы (100 запросов, 10 параллельных потоков):

```bash
python load_test.py https://menu.labus.pro/
```

Параметры:
- `-c, --concurrency` – количество параллельных потоков (по умолчанию 10)
- `-n, --requests` – общее число запросов (по умолчанию 100)
- `-t, --timeout` – таймаут на запрос в секундах (по умолчанию 10)

Пример с 500 запросами и 20 потоками:

```bash
python load_test.py https://menu.labus.pro/ -n 500 -c 20
```

## 3. Интерпретация результатов

Скрипт выводит:
- **Общее время** выполнения всех запросов
- **Количество успешных ответов** (статус 2xx)
- **Таймауты** и **ошибки**
- **RPS (Requests Per Second)** – сколько запросов в секунду выдерживает сервер
- **Время ответа** (среднее, минимальное, максимальное, стандартное отклонение)

## 4. Рекомендуемые сценарии тестирования

### 4.1. Тестирование публичных страниц (кэшируемых)
```bash
python load_test.py https://menu.labus.pro/menu.php -n 1000 -c 50
```

### 4.2. Тестирование API (без кэша)
```bash
python load_test.py https://menu.labus.pro/api/save-push-subscription.php -n 200 -c 5
```
(Осторожно: POST-запросы не поддерживаются в текущем скрипте.)

### 4.3. Сравнение до и после оптимизаций
Запустите тест с одинаковыми параметрами до внедрения изменений и после. Сохраните результаты в файл:

```bash
python load_test.py https://menu.labus.pro/ -n 1000 -c 30 > results_before.txt
```

После оптимизаций:

```bash
python load_test.py https://menu.labus.pro/ -n 1000 -c 30 > results_after.txt
```

## 5. Ограничения

- Скрипт отправляет GET-запросы только на один URL.
- Не имитирует поведение пользователей (переходы между страницами).
- Не поддерживает авторизацию, cookies, сессии.
- Не нагружает базу данных напрямую.

Для более сложных сценариев используйте специализированные инструменты (wrk, Locust, JMeter).

## 6. Безопасность

Не запускайте тест с высокой нагрузкой на продакшен без предупреждения. Начните с малых значений (`-n 100 -c 10`) и постепенно увеличивайте.

## 7. Автоматизация

Для интеграции в CI/CD можно модифицировать скрипт, чтобы он возвращал код ошибки при падении RPS ниже порога.

---

Скрипт создан как часть дорожной карты оптимизации menu.labus.pro. После каждого этапа (индексы БД, Redis, FastCGI cache) повторяйте тестирование для оценки прироста производительности.